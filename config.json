{"metadata":{},"icon":"icon01","settings":{"router":{"mode":"intelligent","animation":"off"},"theme":"","push-notifications":{"android":{"enabled":false},"ios":{"enabled":false},"wp":{"enabled":false}},"provisioning":{"enabled":false,"manifest":"","poll":2,"manual":false,"wifionly":true},"message-queue":{"asb":{"enabled":true,"hostName":"servicebus.windows.net","serviceNamespace":"commontime-qa-sab","keyName":"RootManageSharedAccessKey","key":"eLs7+iKcpODJ5o0XPIUvFpa+nz8K4DCKPVWGHALM+SY=","brokerType":"queue"}}},"name":"Message_Queues","version":"1.1","pages":[{"start":true,"name":"Start","config":[{"name":"On-Load Event","type":"event","item-type":"onload","actions":[{"name":"call_bootstrap","event":"onload","type":"call-function","data":{"name":"bootstrap"}}]}],"content":[{"name":"title_bar","type":"navigation","item-type":"title-bar","content":[{"name":"title","type":"content","item-type":"title","content":"<h1>Message Queue Demo</h1>","expressions":{}}],"extends":{"type":"area","item-type":"row"},"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_1","type":"content","item-type":"html","content":"<h4>Listening to message queues</h4>","expressions":{}},{"name":"listen_row","type":"area","item-type":"row","content":[{"name":"current_queues","type":"content","item-type":"html","content":"<p><strong>Specify the names of the message queues that this device should listen to:</strong></p>\n<p id=\"current_queues\">Obtaining current message queues...</p>","expressions":{}},{"name":"queue_name_txt","type":"question","item-type":"text","label":"Queue","required":false,"multiline":false,"expressions":{},"validators":[],"actions":[]},{"name":"listen_btn","type":"control","item-type":"button","content":"Listen","theme":"default","expressions":{},"left-icon":"fa-play","actions":[{"name":"start_message_queue_listening_1","event":"click","type":"start-message-queue-listening","data":{"channelName":"{{Start.channel_name_txt}}","name":"{{pages.Start.queue_name_txt}}"}},{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"update_queues"}}]},{"name":"stop_listen_btn","type":"control","item-type":"button","content":"Stop listening","theme":"default","expressions":{},"left-icon":"fa-stop","actions":[{"name":"stop_message_queue_listening_1","event":"click","type":"stop-message-queue-listening","data":{"channelName":"{{Start.channel_name_txt}}","name":"{{Start.queue_name_txt}}"}},{"name":"call_function_1","event":"click","type":"call-function","data":{"name":"update_queues"}}]},{"name":"html_6","type":"content","item-type":"html","content":"<p><strong>Note:</strong> If using ASB in \"broadcast\" mode, you must specify your queue as both a topic name and subscription name separated by a forward slash - i.e., topic/subscription. Messages sent to topics can be received by multiple devices but the subscription must be unique to the device for all devices to receive the message.</p>","expressions":{}}],"expressions":{}},{"name":"html_2","type":"content","item-type":"html","content":"<h4>Sending a message</h4>"},{"name":"send_row","type":"area","item-type":"row","content":[{"name":"html_7","type":"content","item-type":"html","content":"<p><strong>Specify the message queues name and the message text to send a message to that message queue:</strong></p>"},{"name":"send_queue_name_txt","type":"question","item-type":"text","label":"Queue (recipient)","required":false,"multiline":false,"expressions":{},"validators":[],"actions":[]},{"name":"send_message_txt","type":"question","item-type":"text","label":"Message","required":false,"multiline":false,"expressions":{},"validators":[],"actions":[]},{"name":"send_btn","type":"control","item-type":"button","content":"Send","theme":"default","expressions":{"show":"pages.Start.send_queue_name_txt.length && pages.Start.send_message_txt.length"},"left-icon":"fa-envelope-o","actions":[{"name":"send_message","event":"click","type":"send-message-queue-message","data":{"name":"{{pages.Start.send_queue_name_txt}}","message":"{ \"from\": \"Message_Queues demo app\", \"text\": \"{{pages.Start.send_message_txt}}\" }"}},{"name":"clear_message_txt","event":"click","type":"set-model","data":{"location":"pages.Start.send_message_txt"}}]},{"name":"html_8","type":"content","item-type":"html","content":"<p>Any other devices which have apps open listening to the specified message queue should receieve the message after a short delay. Any devices which have apps listening to the specified message queue but are not currently running will receive the message after launching the app within a couple of minutes.</p>","expressions":{}}],"expressions":{}},{"name":"html_3","type":"content","item-type":"html","content":"<h4>Received messages will appear below:</h4>","expressions":{}},{"name":"received_row","type":"area","item-type":"row","content":[{"name":"html_4","type":"content","item-type":"html","content":"<ul id=\"message_items\"></ul>"}],"expressions":{}}],"expressions":{}}]}],"config":[{"name":"theme_1","type":"style","item-type":"theme","content":"h4 { margin: 20px 0 10px 0; }\n\n#current_queues { display: block; margin: 0 0 10px 0; }\n\n#listen_row, #send_row, #received_row { display: block; padding: 20px; }\nsection.row-item md-question { display: inline-block; margin: 0 10px 0 0; }\nsection.row-item .md-button-container { display: inline-block; }\nsection.row-item .md-button-container { margin: 0 10px 0 0; line-height: 1em; }\n\n#message_items { margin: 0; padding: 0; list-style-type: none; }\n#message_items .item { margin: 0 0 10px 0; padding: 5px; border: 1px solid #999999; border-left: 3px solid #999999; background: #ffffff; font-size: 0.9em; }\n#message_items .item .received { font-weight: bold; color: #666666; }\n#message_items .item .sent { font-weight: bold; color: #999999; }\n#message_items .item .body { padding-top: 10px; }"},{"name":"log","type":"script","item-type":"function","params":[{"name":"message","required":true}],"content":"console.log(message);"},{"name":"table","type":"script","item-type":"function","params":[{"name":"data","required":true}],"content":"console.table(data);"},{"name":"update_queues","type":"script","item-type":"function","params":[],"content":"if (window.plugins && window.plugins.notify) {\n  window.plugins.notify.listChannels(function (error, channels) {\n    if (!error) {\n      var channelList = channels.join(', ');\n      document.getElementById('current_queues').innerHTML = \"<strong>Currently listening to queues:</strong> \" + channelList;\n    }\n  });\n}"},{"name":"append_message","type":"script","item-type":"function","params":[{"name":"message","required":true}],"content":"var messageItems = document.getElementById('message_items');\nif (messageItems) {\n\n  var li = document.createElement('li');\n  li.id = message.id;\n  li.classList.add('item');\n  messageItems.appendChild(li);\n\n  var received = document.createElement('div');\n  received.classList.add('received');\n  received.textContent = 'Message received on ' + new Date(message.received).toLocaleString('en-GB') + ' from queue \"' + message.queue + '\"';\n  li.appendChild(received);\n  \n  var sent = document.createElement('div');\n  sent.classList.add('sent');\n  sent.textContent = 'Sent on ' + new Date(message.sent).toLocaleString('en-GB') + ' by ' + message.body.from;\n  li.appendChild(sent);\n\n  var body = document.createElement('div');\n  body.classList.add('body');\n  body.textContent = message.body.text;\n  li.appendChild(body);\n}"},{"name":"remove_message","type":"script","item-type":"function","params":[{"name":"messageId","required":true}],"content":"var message = document.getElementById(messageId);\nif (message && message.parentNode) {\n  message.parentNode.removeChild(message);\n}"},{"name":"bootstrap","type":"script","item-type":"function","params":[],"content":"// just some shortcuts to useful functions...\nvar subchannel = 'default';\nvar receiverName = 'com.commontime.md10.messageQueue';\n\nwindow.listChannels = function() {\n  window.plugins.notify.listChannels(function (error, channels) {\n    window.cti.log(channels);\n  });\n};\n\nwindow.getMessages = function(channelName) {\n  window.plugins.notify.getMessages(channelName, subchannel, function (error, messages) {\n\twindow.cti.table(messages);\n  });\n};\n\nwindow.getUnreadMessages = function(channelName) {\n  window.plugins.notify.getUnreadMessages(receiverName, channelName, subchannel, function(error, messages) {\n    window.cti.table(messages);\n  });\n};\n\nwindow.deleteMessage = function(id) {\n  window.plugins.notify.deleteMessage(id, function(error, messages) { });\n};\n\nwindow.deleteAllMessages = function(channelName) {\n  window.plugins.notify.getMessages(channelName, subchannel, function (error, messages) {\n\tangular.forEach(messages, function (msg) {\n      window.plugins.notify.deleteMessage(msg.id);\n    });\n  });\n};"},{"name":"message_queue_init","type":"notification","item-type":"message-queue-event","eventType":"ready","actions":[{"name":"show_queues","event":"click","type":"call-function","data":{"name":"update_queues"}}]},{"name":"message_sent","type":"notification","item-type":"message-queue-event","eventType":"sent","actions":[{"name":"show_sent","event":"click","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"success_notification","title":"Message sent","text":"Message ID: {{$messageId}}"}}]},{"name":"message_received","type":"notification","item-type":"message-queue-event","eventType":"received","actions":[{"name":"show_receieved","event":"click","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"success_notification","text":"{{$message.body.subject}} - {{$message.body.text }}","title":"Your have received a message!"}},{"name":"append_message_call","event":"click","type":"call-function","data":{"name":"append_message","params":{"message":"{{$message}}"}}}]},{"name":"device_notification","type":"notification","item-type":"device-notification","interactions":[]},{"name":"success_notification","type":"notification","item-type":"app-notification","options":{"progressBar":false,"autoDismiss":true,"closeButton":true},"style":"success","actions":[]}],"components":[],"translation":{"default":"en_GB"},"splashdata":{},"splash":"default","workflows":[]}